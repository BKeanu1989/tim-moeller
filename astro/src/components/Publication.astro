---
import { Picture, Image } from "astro:assets";
import type { ContentEntryMap } from "astro:content";
import type { ValidContentEntrySlug } from "astro:content";
import type { CollectionEntry } from "astro:content";
import { getEntry } from "astro:content";

import { getLangFromUrl, useTranslations } from "src/i18n/utils";
const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

type Publication = {
  auhors: string[];
  image: string;
  title: string;
  year: number;
};

interface Props {
  input: CollectionEntry<"publications">;
}

const { input,  } = Astro.props;
const text = input.body;
const { year, image, title, imageAlt, authors} = input.data;

const authorData = []

for await (const d of authors) {
  const res = await getEntry("authors", d)

  authorData.push(res)
}

---

<article class="publication relative bg-c-bg-grey min-h-96 min-w-fit text-black p-5">
  <div class="flex flex-row relative gap-4">

    <div class="flex-none w-1/3">
      <Picture src={image} alt="st"  />
    </div>
    <div class="flex flex-col w-2/3 flex-auto">
      <div class="title">
        <span class="publication--year float-right">
          {year}
        </span>
        <h1 class="inline text-2xl publication-title">{title}</h1>
      </div>
      <div class="publication-authors">
        <ul class="flex gap-2">
          {
            authorData.map((author) => (

              author && 
              <li>
                <Image src={author.data.image} alt={"author " + author.data.name} class="w-10 h-10 rounded-full" />
              </li>
            ))
          }
        </ul>
        <div class="author-names">
          { authorData.map((author) => (
            author &&
              <span class="text-slate-700 ml-1">({author.data.name})</span>

          ))}
        </div>
      </div>
    </div>
  </div>
  <div class="flex flex-col">
    <Fragment class:list={"publication-te text-center"} set:html={text} />
    <a class="px-5 py-2 w-fit text-white rounded bg-blue-500" href={`/publications/${input.id}`}>{t("misc.read_more")}</a>

  </div>
</article>
